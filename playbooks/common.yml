---
- hosts: servers
  become: true
  become_user: root
  vars:
    server_list: servers
  tasks:
    - name: Update apt repo and cache on all {{server_list}}
      include_tasks: ../roles/common/tasks/update.yml 

- hosts: servers
  become: true
  become_user: root
  tasks:
    - name: update server settings
      include_tasks: ../roles/common/tasks/main.yml 

- hosts: servers
  become: true
  become_user: root
  vars_files:
    - ../group_vars/extra-tools.yml
  tasks:
    - name: install extra tools
      include_tasks: ../roles/common/tasks/install-extra-tools.yml 
  tags:
  - common:extra-tools

- hosts: ansible-master
  become: true
  become_user: root
  vars_files:
    - ../group_vars/extra-tools.yml
  tasks:
    - name: install extra tools
      include_tasks: ../roles/common/tasks/install-pip-tools.yml 
  tags:
  - common:pip-tools

- hosts: gitlab
  become: true
  become_user: root
  gather_facts: false
  tasks:
    - name: Install GitLab Dependecies
      include_tasks: ../roles/common/tasks/gitlab.yml 
  tags:
  - common:gitlab
